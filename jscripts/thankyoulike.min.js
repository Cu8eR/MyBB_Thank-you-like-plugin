var tylDataList=new Array,tylExpIdsByUser=new Array,tylCollIdsByUser=new Array,tylOurUidIdxExp=-1,tylOurUidIdxColl=-1,tylAddDoneHooks=new Array,tylDelDoneHooks=new Array,thankyoulike={init:function(){$("[id^='tyl_data_']").each(function(){tylDataList.push(parseInt($(this).attr("id").match(/\d+/)),10)});var l=thankyoulike.parseExpCollCookie("tylexpids",tylUser);tylOurUidIdxExp=l.ouruididx,tylExpIdsByUser=l.array,l=thankyoulike.parseExpCollCookie("tylcollids",tylUser),tylOurUidIdxColl=l.ouruididx,tylCollIdsByUser=l.array;var t=0;for(t=0;t<tylDataList.length;++t){var e=$.inArray(tylDataList[t],tylExpIdsByUser[tylOurUidIdxExp].pids),r=$.inArray(tylDataList[t],tylCollIdsByUser[tylOurUidIdxColl].pids);-1!==e&&-1!==r&&(tylExpIdsByUser[tylOurUidIdxExp].pids.splice(e,1),tylCollIdsByUser[tylOurUidIdxColl].pids.splice(r,1),e=r=-1),1==tylCollapsible&&("closed"==tylCollDefault&&-1===e||"open"==tylCollDefault&&-1!==r)?thankyoulike.fleece(tylDataList[t]):thankyoulike.display(tylDataList[t])}},parseExpCollCookie:function(l,t){var e=!1,r=-1,o=new Array,s=Cookie.get(l),y=0;if(s)for(var i=s.split(/;/),a=0;a<i.length;++a)splitArr=i[a].split(/:/),splitArr.length>=2&&(splitArr[0]==t&&(e=!0,r=y),o[y++]={uid:parseInt(splitArr[0],10),pids:splitArr[1]?$.uniqueSort(splitArr[1].split(/,/).map(function(l){return parseInt(l,10)})):new Array});return e||(o[y]={uid:t,pids:new Array},r=y),{ouruididx:r,array:o}},saveExpCollCookie:function(l,t){var e,r="";for(e=0;e<t.length;e++)r&&(r+=";"),r+=t[e].uid+":"+t[e].pids.join(",");Cookie.set(l,r)},tgl:function(l){if(1==tylCollapsible){var t=$.inArray(l,tylExpIdsByUser[tylOurUidIdxExp].pids),e=$.inArray(l,tylCollIdsByUser[tylOurUidIdxColl].pids);$("#tyl_data_"+l).is(":visible")?(thankyoulike.fleece(l),-1!==t&&tylExpIdsByUser[tylOurUidIdxExp].pids.splice(t,1),-1===e&&tylCollIdsByUser[tylOurUidIdxColl].pids.push(l)):(thankyoulike.display(l),-1!==e&&tylCollIdsByUser[tylOurUidIdxColl].pids.splice(e,1),-1===t&&tylExpIdsByUser[tylOurUidIdxExp].pids.push(l)),thankyoulike.saveExpCollCookie("tylexpids",tylExpIdsByUser),thankyoulike.saveExpCollCookie("tylcollids",tylCollIdsByUser)}},fleece:function(l){$("#tyl_data_"+l+",#tyl_title_"+l).hide(),$("#tyl_title_collapsed_"+l).show(),$("#tyl_i_expcol_"+l).attr("src")&&$("#tyl_i_expcol_"+l).attr("src",$("#tyl_i_expcol_"+l).attr("src").replace("collapse.png","collapse_collapsed.png")),$("#tyl_i_expcol_"+l).attr("alt","[+]"),$("#tyl_a_expcol_"+l).attr("title","[+]")},display:function(l){$("#tyl_data_"+l+",#tyl_title_"+l).show(),$("#tyl_title_collapsed_"+l).hide(),$("#tyl_i_expcol_"+l).attr("src")&&$("#tyl_i_expcol_"+l).attr("src",$("#tyl_i_expcol_"+l).attr("src").replace("collapse_collapsed.png","collapse.png")),$("#tyl_i_expcol_"+l).attr("alt","[-]"),$("#tyl_a_expcol_"+l).attr("title","[-]")},add:function(l){return 1!=use_xmlhttprequest||1!=tylEnabled||(0==tylUser||($.ajax("thankyoulike.php?ajax=1&action=add&pid="+l+"&my_post_key="+my_post_key,{type:"post",success:function(t){thankyoulike.addDone(t,l)}}),document.body.style.cursor="wait",!1))},addDone:function(l,t){if("string"==typeof l){var e=$.parseJSON(l);e&&(1==tylDisplayGrowl?$.jGrowl(e,{theme:"jgrowl_error"}):alert(e)),document.body.style.cursor="default"}else if(l.errors)$.jGrowl(l.errors.join(" "),{theme:"jgrowl_error"});else{if(1==tylDisplayGrowl){var r=tylSend,o={theme:"jgrowl_success"};l.tylMsgNumLeft&&(r+="<br />\n<br />\n"+l.tylMsgNumLeft,l.tylMsgLife&&(o.life=l.tylMsgLife)),$.jGrowl(r,o)}if($("#tyl_"+t).html(l.tylData),$("#tyl_"+t).css("display",""),$("#tyl_btn_"+t).before(l.tylButton).remove(),tylAddDoneHooks)for(var s=0;s<tylAddDoneHooks.length;s++)tylAddDoneHooks[s](l,t)}document.body.style.cursor="default"},del:function(l){return 1!=use_xmlhttprequest||1!=tylEnabled||(0==tylUser||($.ajax("thankyoulike.php?ajax=1&action=del&pid="+l+"&my_post_key="+my_post_key,{type:"post",success:function(t){thankyoulike.delDone(t,l)}}),document.body.style.cursor="wait",!1))},delDone:function(l,t){if("string"==typeof l){var e=$.parseJSON(l);e&&(1==tylDisplayGrowl?$.jGrowl(e,{theme:"jgrowl_error"}):alert(e)),document.body.style.cursor="default"}else if(l.errors)$.jGrowl(l.errors.join(" "),{theme:"jgrowl_error"});else if(1==tylDisplayGrowl&&$.jGrowl(tylRemove,{theme:"jgrowl_success"}),$("#tyl_"+t).html(l.tylData),$("#tyl_"+t).css("display",""),$("#tyl_btn_"+t).before(l.tylButton).remove(),tylDelDoneHooks)for(var r=0;r<tylDelDoneHooks.length;r++)tylDelDoneHooks[r](l,t);document.body.style.cursor="default"}};$(function(){thankyoulike.init()});